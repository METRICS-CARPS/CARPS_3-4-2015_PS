---
title: "CARPS Reproducibility Report"
output:
  html_document:
    toc: true
    toc_float: true
---

#### Article ID: CARPS_3-4-2015_PS
#### Pilot 1: Erik Santoro
#### Co-pilot: Tysen Dauer & Jaclyn Schwartz
#### Start date: 10/31/2017
#### End date: [Insert end date - use US format]   

-------

#### Methods summary: 
[Write a brief summary of the methods underlying the target outcomes written in your own words]

------

#### Target outcomes: 
[Insert the target outcomes identified in targetOutcomes.md]  

------

[The chunk below sets up some formatting options for the R Markdown document]

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```

## Step 1: Load packages

[Some useful packages are being loaded below. You can add any additional ones you might need too.]

```{r}
library(tidyverse) # for data munging
library(knitr) # for kable table formating
library(haven) # import and export 'SPSS', 'Stata' and 'SAS' Files
library(readxl) # import excel files
library(CARPSreports) # custom report functions
```

```{r Load package for repeated measures anova}

library(ez) # for repeated ANOVAs
library(effsize) #for effect size
library(compute.es) #for effect size
library(lsr) #for partial eta squared
```


## Step 2: Load data

```{r Load data}

d <- read.table("data/Bogus visual feedback alters movement_Data.tab", header=TRUE)

```

## Step 3: Tidy data

```{r Tidy data}

#Tidy 1 -- tidying across condition

d.tidy.1 <- d %>%
  gather(condition,rangeofmotion,starts_with("condition")) #the value various condition columns contains are the range of motion

d.tidy.1$Participant <- as.factor(d.tidy.1$Participant)
d.tidy.1$condition <- as.factor(d.tidy.1$condition)


#Tidy 2 -- testing hypothesis of looking at participant per direction as a separate trial

d.tidy.2 <- d %>%
  mutate(trial = Participant * DirectionofRotation) %>% # creates a separate row at a participation * rotation
  select(-Participant,-DirectionofRotation) %>%
  gather(condition,rangeofmotion,starts_with("condition")) 
  
d.tidy.2$trial <- as.factor(d.tidy.2$trial)
d.tidy.2$condition <- as.factor(d.tidy.2$condition)

```

## Step 4: Run analysis

### Pre-processing

Assumption 1: The paper indicates that the data needs to be normalized: "To account for between-subject differences in range of motion, we transformed data for each participant to a proportion of the average range of motion demonstrated in the neutral condition." However, given the range of motion before feeling pain is 1 for each participant under the neutral (pain gain = 1) condition, I *assume the data has already been normalized.*

Assumption 2: The paper speaks of "participantâ€™s average movement-evoked pain for each condition." As such, I assume that I need to average the left & right (e.g. direction of rotation 1 & 2).

### Descriptive statistics

```{r Average by condition}

#For T tests

d.comparison <- d %>%
  group_by(Participant) %>%
  summarise(meancondition1_gain0.8 = mean(Condition1_Gain0.8),
            meancondition2_gain1 = mean(Condition2_Gain1),
            meancondition3_gain1.2 = mean(Condition3_Gain1.2)
              )
  
  
#For comparing means

  d.simplified <- d.comparison %>%
    gather(condition,rangeofmotion,starts_with("mean")) %>%
    group_by(condition) %>%
    summarise(meanrangeofmotion = mean(rangeofmotion))
  
  
```


```{r Means}

mean0.8 <- mean(d.comparison$meancondition1_gain0.8)
mean1 <- mean(d.comparison$meancondition2_gain1)
mean1.2 <- mean(d.comparison$meancondition3_gain1.2)

pctchng0.8v1 <- 100*((mean0.8-mean1)/mean1)
pctchng1.2v1 <- 100*((mean1.2-mean1)/mean1)

```


```{r Standard deviations}


sd0.8 <- sd(d.comparison$meancondition1_gain0.8) 
sd1 <- sd(d.comparison$meancondition2_gain1) 
sd1.2 <- sd(d.comparison$meancondition3_gain1.2) 

sdpool0.8v1 <- sqrt((sd0.8**2 + sd1**2)/2)

sdpool1v1.2 <- sqrt((sd1.2**2 + sd1**2)/2)


```


### Inferential statistics

```{r Repeated Measures ANOVA}

#Version 1

modANOVA.1 <- ezANOVA(data = d.tidy.1,
                  dv = rangeofmotion,
                  wid = Participant,
                  within = .(condition),
                  within_full = DirectionofRotation, #use this so the condition data is collapsed to mean of DirectionofRotation; becuase observations are the same, I think it's fine; https://groups.google.com/forum/#!topic/ez4r/e1MoQc06F4o
                  detailed = TRUE,
                  return_aov = TRUE) #returns aov object, which is useful for calculating partial eta squared

print(modANOVA.1)


#Version 2

modANOVA.2 <- ezANOVA(data = d.tidy.2,
                  dv = rangeofmotion,
                  wid = trial,
                  within = .(condition),
                  detailed = TRUE)

print(modANOVA.2)


#demoAnova <- ezANOVA(myData, # specify data frame
#                     dv = RT, # specify dependent variable 
#                     wid = subject, # specify the subject variable
#                     within = .(block, check), # specify within-subject variables
#                     detailed = TRUE # get a detailed table that includes SS
#                     )

#Repeated ANOVA in R: http://sherifsoliman.com/2014/12/10/ANOVA_in_R/ ; https://www.r-statistics.com/2010/04/repeated-measures-anova-with-r-tutorials/


```

```{r Effect Size}

d0.8v1 <- (mean0.8 - mean1) / sdpool0.8v1

d1v1.2 <- (mean1.2 - mean1) / sdpool1v1.2

print(d0.8v1) #when vision understated motion, hence range of motion increased
print(d1v1.2) #when vision overstated motion, hence range of motion decreased

```

```{r Confidence Intervals}

t.test0.8v1 <- t.test(d.comparison$meancondition1_gain0.8,d.comparison$meancondition2_gain1)$conf.int
t.test1.2v1 <- t.test(d.comparison$meancondition2_gain1,d.comparison$meancondition3_gain1.2)$conf.int

#Vision understated true rotation
pctchng0.8v1
t.test0.8v1

#Vision overstated true rotation
pctchng1.2v1
t.test1.2v1

```


```{r T tests}

#T-test by condition

ttest_0.8v1 <- t.test(d.comparison$meancondition1_gain0.8, d.comparison$meancondition2_gain1, paired = TRUE)

ttest_0.8v1.2 <- t.test(d.comparison$meancondition1_gain0.8, d.comparison$meancondition3_gain1.2, paired = TRUE)

ttest_1.2v1 <- t.test(d.comparison$meancondition2_gain1, d.comparison$meancondition3_gain1.2, paired = TRUE)

print(ttest_0.8v1)
print(ttest_0.8v1.2)
print(ttest_1.2v1)

```


```{r Comparison of effect sized}


cohen.d(d.comparison$meancondition1_gain0.8)

cohen.d(d.comparison$meancondition2_gain1, d.comparison$meancondition3_gain1.2)

comput

```


## Step 5: Conclusion

[Include the carpsReport function below]

```{r}
# You can delete this commented text for your report, it is here to serve as a guide.
# Use the carpsReport() function in this code chunk.
# Here is a guide to the arguments you should include in the function:
# Report_Type: Enter 'pilot' or 'final'
# Article_ID: Enter the article's unique ID code
# Insufficient_Information_Errors: Enter the number of Insufficient Information Errors
# Decision_Errors Enter: the number of decision errors
# Major_Numerical_Errors: Enter the number of major numerical errors
# Time_to_Complete: Enter the estimated time to complete the report in minutes
# Author_Assistance: Enter whether author assistance was required (TRUE/FALSE)
# FOR EXAMPLE:
# carpsReport(Report_Type = "pilot", 
#             Article_ID = "ABhgyo", 
#             Insufficient_Information_Errors = 0, 
#             Decision_Errors = 1, 
#             Major_Numerical_Errors = 4, 
#             Time_to_Complete = 120, 
#             Author_Assistance = TRUE)
```

[Please also include a brief text summary describing your findings. If this reproducibility check was a failure, you should note any suggestions as to what you think the likely cause(s) might be.]

[This function will output information about the package versions used in this report:]

```{r session_info, include=TRUE, echo=TRUE, results='markup'}
devtools::session_info()
```
